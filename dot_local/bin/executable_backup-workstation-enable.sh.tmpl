#!/bin/bash
#
# Workstation Backup - Enable Script
#

PLIST_PATH="$HOME/Library/LaunchAgents/com.backup.workstation.plist"
LABEL="com.backup.workstation"

if ! [ -f "$PLIST_PATH" ]; then
    echo "Error: LaunchAgent plist not found at $PLIST_PATH"
    echo "Run 'chezmoi apply' first."
    exit 1
fi

# 이미 로드되어 있으면 먼저 언로드
launchctl list | grep -q "$LABEL" && launchctl unload "$PLIST_PATH" 2>/dev/null

if launchctl load "$PLIST_PATH" 2>/dev/null; then
    echo "Workstation backup enabled (runs every 30 minutes)"
    echo "Backup destination: {{ .work_backup_dest }}"
    echo "Backup paths: {{ .work_backup_paths }}"
else
    echo "Error: Failed to enable backup"
    exit 1
fi
