source /opt/homebrew/opt/zinit/zinit.zsh

# z-a-bin-gem-node
zinit light zdharma-continuum/zinit-annex-bin-gem-node
zinit light zdharma-continuum/zinit-annex-patch-dl

# prezto
zstyle ':prezto:module:editor' key-bindings 'vi'
zstyle ':prezto:module:terminal' auto-title 'yes'
zstyle ':prezto:module:utility:ls' color 'yes'
zstyle ':prezto:module:utility:ls' dirs-first 'yes'
zstyle ':prezto:module:utility:grep' color 'yes'
zstyle ':prezto:module:utility:diff' color 'yes'
zstyle ':prezto:module:utility:make' color 'yes'


zinit snippet PZTM::environment
zinit ice wait lucid
zinit snippet PZTM::completion
zinit ice wait lucid
zinit snippet PZTM::directory
zinit snippet PZTM::editor
zinit ice wait lucid
zinit snippet PZTM::gnu-utility
zinit ice wait lucid
zinit snippet PZTM::utility

# oh-my-zsh
zinit ice wait lucid
zinit snippet OMZP::fzf

# forgit
zinit ice wait lucid
zinit light wfxr/forgit

# zsh-completions & fast-syntax-highlighting
zinit wait lucid light-mode for \
  atinit"zicompinit; zicdreplay" \
      zdharma-continuum/fast-syntax-highlighting \
  blockf atpull'zinit creinstall -q .' \
      zsh-users/zsh-completions

# direnv
zinit light-mode as"program" make'!' mv"direnv* -> direnv" \
  atclone'./direnv hook zsh > zhook.zsh' atpull'%atclone' \
  pick"direnv" src="zhook.zsh" for \
    direnv/direnv

# pyenv
zinit wait lucid as'program' pick'bin/pyenv' atinit'export PYENV_ROOT="$PWD"' \
    atclone'PYENV_ROOT="$PWD" ./libexec/pyenv init - > zpyenv.zsh' \
    atpull"%atclone" src"zpyenv.zsh" nocompile'!' for \
        pyenv/pyenv
export PATH="$HOME/.zinit/plugins/pyenv---pyenv/shims:${PATH}"

# nvm
zinit wait lucid as'program' src='zsh-nvm.plugin.zsh' nocompile'!' for lukechilds/zsh-nvm

export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
export FZF_CTRL_T_OPTS="--preview 'bat --style=numbers --color=always --line-range :200 {}'"

# thefuck
zinit ice wait lucid
zinit light laggardkernel/zsh-thefuck

autoload compinit
compinit

# alias
alias vim=nvim
eval $(thefuck --alias)

# color
export CLICOLOR=1;

function coalesce { print "${${(s: :)@}[1]}" }
export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES

export LDFLAGS="-L/usr/local/opt/openssl/lib"
export CPPFLAGS="-I/usr/local/opt/openssl/include"

alias tmux='direnv exec / tmux'

precmd () {print -Pn "\e]0;%~\a"}

# history
HISTSIZE=999999999
SAVEHIST=999999999
setopt    appendhistory
setopt    sharehistory
setopt    incappendhistory

. /opt/homebrew/opt/asdf/libexec/asdf.sh
alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"
eval "$(zoxide init zsh)"
eval "$(starship init zsh)"
