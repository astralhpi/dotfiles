{{- $duckdb := dict
  "command" "uvx"
  "args" (list "mcp-server-motherduck" "--db-path" "md:" "--motherduck-token" .motherduck_token)
  "env" (dict)
-}}
{{- $postgres := dict
  "command" "uvx"
  "args" (list "postgres-mcp")
  "env" (dict "DATABASE_URI" .postgres_url)
-}}
{{- $context7 := dict
  "settings" (dict "default_minimum_tokens" "10000")
-}}
{{- $github := dict
  "settings" (dict "github_personal_access_token" .github_pat)
-}}
{{- $clickhouse := dict
  "command" "uv"
  "args" (list "run" "--with" "mcp-clickhouse" "--python" "3.10" "mcp-clickhouse")
  "env" (dict
    "CLICKHOUSE_HOST" .clickhouse_host
    "CLICKHOUSE_PORT" .clickhouse_port
    "CLICKHOUSE_USER" .clickhouse_user
    "CLICKHOUSE_PASSWORD" .clickhouse_password
    "CLICKHOUSE_SECURE" "true"
    "CLICKHOUSE_VERIFY" "true"
    "CLICKHOUSE_CONNECT_TIMEOUT" "30"
    "CLICKHOUSE_SEND_RECEIVE_TIMEOUT" "60"
  )
-}}

{{- /* Define wrapper functions */ -}}
{{- $zedCustomWrapper := dict "source" "custom" "enabled" true -}}
{{- $zedExtensionWrapper := dict "source" "extension" "enabled" true -}}

{{- if eq .format "common" -}}
{
  "duckdb": {{ $duckdb | toJson }},
  "postgres": {{ $postgres | toJson }}
}
{{- else if eq .format "zed" -}}
{
  "duckdb": {{- $zedCustomWrapper | merge $duckdb | toJson }},
  "mcp-server-context7": {{- $zedExtensionWrapper | merge $context7 | toJson }},
  "mcp-server-github": {{- $zedExtensionWrapper | merge $github | toJson }},
  "postgres": {{- $zedCustomWrapper | merge $postgres | toJson }}
}
{{- end -}}
